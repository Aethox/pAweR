<!DOCTYPE html>
<html lang="en">
    <head>
        <title>PawerGroom - AR Experience</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="/style.css">
        <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    </head>  
    <body>
        <a-scene embedded 
                 arjs="trackingMethod: best; debugUIEnabled: false; minConfidence: 0.6;" 
                 renderer="logarithmicDepthBuffer: true;">
            <a-assets>
                <video id="pawer-logo" 
                       autoplay="true" 
                       playsinline 
                       preload="auto" 
                       src="Assets/pawerLogoMusic.mp4"
                       crossorigin="anonymous"
                       fetchpriority="high"></video>
                <img id="cat" src="Assets/Cat.svg" crossorigin="anonymous"></img>
                <img id="info" src="Assets/Info.png" crossorigin="anonymous"></img>
                <img id="cursor" src="Assets/cursor.svg" crossorigin="anonymous"></img>
                <img id="dogs" src="Assets/Dogs.svg" crossorigin="anonymous"></img>
                <img id="arrow" src="Assets/Arrow.png" crossorigin="anonymous"></img>
                <img id="wsplogo" src="Assets/WhatsAppLogo.png" crossorigin="anonymous"></img>
            </a-assets>
        
            <a-marker type="pattern" url="Assets/paw2.patt" emit-events="true" smooth="true" smoothCount="15" smoothTolerance="0.005" smoothThreshold="0.01">
                <a-image src="#cat" position="-3.5 0 -9" width="5" height="5" rotation="-90 10 0"></a-image>
                <a-image src="#dogs" position="1 0 -9" width="5" height="5" rotation="-90 0 0"></a-image>
                <a-image src="#arrow" position="-4 0 -4" width="2" height="2" rotation="-90 0 0"></a-image>
                <a-image src="#wsplogo" 
                        class="clickable"
                        open-whatsapp
                        position="-4.5 0 -4" 
                         width="2" 
                         height="2" 
                         rotation="-90 0 0"
                         geometry="primitive: plane; width: 2; height: 2;"
                         material="shader: flat">
                        </a-image>
                <a-plane src="#info" position="4 0 -3" rotation="-90 0 0" width="4" height="8.2"></a-plane>
                <a-image src="#cursor" position="3.5 0 -5" width="1.5" height="1.5" rotation="-90 0 0" shadow="receive: true"></a-image>
                <a-video id="video-entity" src="#pawer-logo" width="5" height="5" position="0 0 0" rotation="-90 0 0"></a-video>
            </a-marker>
            <a-entity camera="zoom: 1; fov: 60">
                <a-cursor
                    raycaster="objects: .clickable"
                    fuse="false"
                    material="color: white; shader: flat"
                    geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                    position="0 0 -1">
                </a-cursor>
            </a-entity>
        <style>
            .a-enter-vr {
                display: none;
            }
            #video-entity {
                opacity: 1;
                transition: opacity 0.5s ease-in-out;
            }
        </style>
        <script>
          AFRAME.registerComponent('open-whatsapp', {
                init: function () {
                this.el.addEventListener('click', () => {
                    console.log("ðŸ”— Redirigiendo a WhatsApp");
                    window.open('https://wa.me/+573157029102', '_blank');
                });
                }
            });
        // Initialize video functionality and reduce flickering
        window.addEventListener('load', function() {
            const video = document.getElementById('pawer-logo');
            const videoEntity = document.getElementById('video-entity');
            const marker = document.querySelector('a-marker');
            const assets = document.querySelectorAll('a-image, a-plane, a-video');
            
            // Add click event to redirect to WhatsApp link
            // const wsplogo = document.querySelector('a-image[src="#wsplogo"]'); 
            // wsplogo.addEventListener('click', function() {
            //     window.open('https://wa.me/+573157029102', '_blank');
            // });

            // Make sure video is loaded and ready
            video.load();
            video.muted = false;

            // Preload assets to reduce flickering
            assets.forEach(asset => {
            asset.addEventListener('materialtextureloaded', () => {
                asset.setAttribute('visible', true);
            });
            asset.setAttribute('visible', false); // Hide initially
            });

            // Handle marker found event
            marker.addEventListener('markerFound', function() {
            if (video.paused) {
                video.play();
            }
            videoEntity.setAttribute('visible', true);
            videoEntity.style.opacity = "1";

            // Ensure all assets are visible
            assets.forEach(asset => {
                asset.setAttribute('visible', true);
            });
            });

            // Handle marker lost event
            marker.addEventListener('markerLost', function() {
            videoEntity.style.opacity = "0.9"; // Slightly fade but keep visible

            // Keep assets visible to reduce flickering
            assets.forEach(asset => {
                asset.setAttribute('visible', true);
            });

            // Ensure the video keeps playing
            if (video.paused) {
                video.play();
            }
            });

            // Force play on user interaction (needed for mobile)
            document.addEventListener('click', function() {
            if (video.paused) {
                video.play();
            }
            });
        });
        </script>
    </body>
</html>
