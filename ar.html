<!DOCTYPE html>
<html lang="en">
<head>
  <title>PawerGroom - AR Experience</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="stylesheet" href="/style.css">
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body>

<a-scene embedded
         arjs="trackingMethod: best; debugUIEnabled: false; minConfidence: 0.6;"
         renderer="logarithmicDepthBuffer: true; antialias: true;">

  <a-assets>
    <video id="pawer-logo" autoplay playsinline preload="auto"
           src="Assets/pawerLogoMusic.mp4" crossorigin="anonymous"></video>
    <img id="cat" src="Assets/Cat.svg" crossorigin="anonymous">
    <img id="dogs" src="Assets/Dogs.svg" crossorigin="anonymous">
    <img id="arrow" src="Assets/Arrow.png" crossorigin="anonymous">
    <img id="info" src="Assets/Info.png" crossorigin="anonymous">
    <img id="wsplogo" src="Assets/WhatsAppLogo.png" crossorigin="anonymous">
    <img id="cursor1" src="Assets/cursor.svg" crossorigin="anonymous">
  </a-assets>

  <a-marker id="marker" type="pattern"
            url="Assets/paw2.patt"
            emit-events="true"
            smooth="true"
            smoothCount="15"
            smoothTolerance="0.005"
            smoothThreshold="0.01">

    <a-entity id="content">
      <a-image src="#cat" position="-3.5 0 -9" width="5" height="5" rotation="-30 10 0"></a-image>
      <a-image src="#dogs" position="1 0 -9" width="5" height="5" rotation="-30 0 0"></a-image>
      <a-image src="#arrow" position="-4.5 0 -4" width="2" height="2" rotation="-90 0 0"></a-image>

      <a-image id="wsp"
               class="clickable"
               open-whatsapp
               src="#wsplogo"
               width="2" height="2"
               rotation="-90 0 0"
               position="-6 0 -4"
               geometry="primitive: plane; height: 2; width: 2"
               material="shader: flat"></a-image>

      <a-plane src="#info" position="6 0 -3" rotation="-90 0 0" width="4" height="8.2"></a-plane>
      <a-image src="#cursor1" position="3.5 0 -5" width="1.5" height="1.5" rotation="-90 0 0"></a-image>
      <a-video id="video-entity" src="#pawer-logo" width="5" height="5" position="0 0 0" rotation="-90 0 0"></a-video>
    </a-entity>
  </a-marker>

  <a-entity camera look-controls>
    <a-cursor raycaster="objects: .clickable"
              fuse="false"
              material="color: white; shader: flat"
              geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
              position="0 0 -1"></a-cursor>
  </a-entity>
</a-scene>

<style>
  .a-enter-vr {
    display: none;
  }
</style>

<script>
  // Componente para redireccionar a WhatsApp
  AFRAME.registerComponent('open-whatsapp', {
    init: function () {
      this.el.addEventListener('click', function () {
        console.log('WhatsApp logo clicked!');
        window.open('https://wa.me/+573157029102', '_blank');
      });
    }
  });

  // Control de aparición y desaparición de modelos al detectar marcador
  window.addEventListener('load', () => {
    const video = document.getElementById('pawer-logo');
    const videoEntity = document.getElementById('video-entity');
    const content = document.getElementById('content');
    const marker = document.getElementById('marker');

    // Ocultar contenido al principio
    content.setAttribute('visible', false);

    marker.addEventListener('markerFound', () => {
      console.log("🔍 Marker detectado");
      content.setAttribute('visible', true);
      if (video.paused) video.play();
    });

    marker.addEventListener('markerLost', () => {
      console.log("❌ Marker perdido");
      content.setAttribute('visible', false);
    });

    document.addEventListener('click', () => {
      if (video.paused) video.play();
    });
  });
</script>

</body>
</html>
